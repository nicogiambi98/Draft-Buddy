#:import dp kivy.metrics.dp
#:import SlideTransition kivy.uix.screenmanager.SlideTransition

# Root container with fixed BottomNav
<Root@BoxLayout>:
    orientation: 'vertical'
    ScreenManager:
        id: sm
        transition: SlideTransition(duration=0.18)
    BottomNav:
        id: bottomnav

# Typography tokens
<TitleLabel@Label>:
    font_size: '20sp'
    bold: True
<HeaderLabel@Label>:
    font_size: '16sp'
    bold: True
<BodyLabel@Label>:
    font_size: '14sp'
<CaptionLabel@Label>:
    font_size: '12sp'
    color: 0.6, 0.6, 0.6, 1

# Button styles
<PrimaryButton@Button>:
    size_hint_y: None
    height: dp(48)
    padding: [dp(12), dp(10)]
    background_normal: ''
    background_color: 0.16, 0.47, 0.96, 1  # blue
    color: 1, 1, 1, 1
<SecondaryButton@Button>:
    size_hint_y: None
    height: dp(48)
    padding: [dp(12), dp(10)]
    background_normal: ''
    background_color: 0.9, 0.9, 0.9, 1
    color: 0.1, 0.1, 0.1, 1

# Bottom navigation reusable widget
<BottomNav>:
    size_hint_y: None
    height: dp(56)
    ScrollView:
        id: nav_scroll
        size_hint_y: None
        height: dp(56)
        do_scroll_x: True
        do_scroll_y: False
        bar_width: 0
        effect_y: None
        on_scroll_stop: root.normalize_scroll()
        BoxLayout:
            id: nav_row
            size_hint_x: None
            width: self.minimum_width
            height: dp(56)
            orientation: 'horizontal'
            spacing: 0
            # Group 1 (for circular effect)
            Button:
                text: "Players"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('players')
            Button:
                text: "Events"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('eventslist')
            Button:
                text: "League Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('league')
            Button:
                text: "Bingo"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('bingo')
            Button:
                text: "Draft Timer"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('drafttimer')
            Button:
                text: "Life Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('lifetracker')
            # Group 2 (middle group for centering)
            Button:
                text: "Players"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('players')
            Button:
                text: "Events"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('eventslist')
            Button:
                text: "League Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('league')
            Button:
                text: "Bingo"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('bingo')
            Button:
                text: "Draft Timer"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('drafttimer')
            Button:
                text: "Life Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('lifetracker')
            # Group 3 (for circular effect)
            Button:
                text: "Players"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'players' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('players')
            Button:
                text: "Events"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'eventslist' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('eventslist')
            Button:
                text: "League Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'league' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('league')
            Button:
                text: "Bingo"
                size_hint_x: None
                width: dp(120)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'bingo' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('bingo')
            Button:
                text: "Draft Timer"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'drafttimer' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('drafttimer')
            Button:
                text: "Life Tracker"
                size_hint_x: None
                width: dp(140)
                background_normal: ''
                background_color: (0.16, 0.47, 0.96, 1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.92, 0.92, 0.92, 1)
                color: (1,1,1,1) if app.root and app.root.ids and 'sm' in app.root.ids and app.root.ids.sm.current == 'lifetracker' else (0.1,0.1,0.1,1)
                on_release: app.switch_tab('lifetracker')

# Global button text alignment
<Button>:
    # Make all button texts centered and consistent
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    padding: [dp(4), dp(4)]

<PlayersScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            TitleLabel:
                text: "Players"
            PrimaryButton:
                text: "New Player"
                size_hint_x: None
                width: dp(140)
                height: dp(40)
                on_release: root.open_add_player()

        BoxLayout:
            size_hint_y: None
            height: dp(36)
            TextInput:
                id: filter_input
                hint_text: "Filter..."
                multiline: False
                on_text: self.text = self.text.lstrip(); root.filter_players(self.text)

        ScrollView:
            GridLayout:
                id: players_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(6)
                row_default_height: dp(56)

<NewPlayerScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        TitleLabel:
            text: "Add New Player"
        TextInput:
            id: name_input
            hint_text: "Player name"
            multiline: False
            on_text: self.text = self.text.lstrip()
            on_text_validate: root.save_player(self.text)
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            PrimaryButton:
                text: "Save"
                on_release:
                    root.save_player(name_input.text)
            SecondaryButton:
                text: "Back"
                on_release: root.manager.current = "players"

<CreateEventDetailsScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(12)
        spacing: dp(10)
        TitleLabel:
            text: "Create Event"
            size_hint_y: None
            height: dp(40)
        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'top'
            size_hint_y: 1
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.96
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(12)
                canvas.before:
                    Color:
                        rgba: 1,1,1,1
                    Line:
                        rectangle: (self.x, self.y, self.width, self.height)
                        width: 1.2
                GridLayout:
                    cols: 2
                    col_default_width: dp(140)
                    col_force_default: False
                    size_hint_y: None
                    height: self.minimum_height
                    row_default_height: dp(48)
                    row_force_default: True
                    spacing: dp(8)
                    padding: [dp(8), dp(8)]
                    HeaderLabel:
                        text: "Event name"
                        size_hint_x: None
                        width: dp(140)
                    TextInput:
                        id: event_name
                        hint_text: "Event name"
                        multiline: False
                        on_text: self.text = self.text.lstrip()
                        on_text_validate: rounds_input.focus = True
                    HeaderLabel:
                        text: "Type"
                        size_hint_x: None
                        width: dp(140)
                    Spinner:
                        id: event_type
                        text: "draft"
                        values: ["draft", "sealed", "cube"]
                        size_hint_y: None
                        height: dp(48)
                    HeaderLabel:
                        text: "Rounds"
                        size_hint_x: None
                        width: dp(140)
                    TextInput:
                        id: rounds_input
                        hint_text: "e.g. 3"
                        multiline: False
                        input_filter: "int"
                        on_text: self.text = self.text.lstrip()
                        on_text_validate: round_time.focus = True
                    HeaderLabel:
                        text: "Round time (min)"
                        size_hint_x: None
                        width: dp(140)
                    TextInput:
                        id: round_time
                        hint_text: "e.g. 30"
                        multiline: False
                        input_filter: "int"
                        on_text: self.text = self.text.lstrip()
                BoxLayout:
                    size_hint_y: None
                    height: dp(52)
                    spacing: dp(8)
                    PrimaryButton:
                        text: "Next: Add Players"
                        on_release:
                            root.next_to_players(event_name.text, event_type.text, rounds_input.text, round_time.text)
                    SecondaryButton:
                        text: "Cancel"
                        on_release: root.manager.current = "eventslist"

<CreateEventScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        TitleLabel:
            text: "Add Players"
            size_hint_y: None
            height: dp(32)
        BoxLayout:
            size_hint_y: None
            height: dp(36)
            TextInput:
                id: filter_input
                hint_text: "Filter players..."
                multiline: False
                on_text: self.text = self.text.lstrip(); root.filter_players(self.text)
        BoxLayout:
            spacing: dp(8)
            BoxLayout:
                orientation: 'vertical'
                HeaderLabel:
                    text: "Selectable players"
                    size_hint_y: None
                    height: dp(24)
                ScrollView:
                    canvas.after:
                        Color:
                            rgba: 1, 1, 1, 1
                        Line:
                            rectangle: (self.x, self.y, self.width, self.height)
                            width: 1.2
                    GridLayout:
                        id: players_select
                        cols: 1
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(6)
                        row_default_height: dp(56)
            BoxLayout:
                orientation: 'vertical'
                HeaderLabel:
                    text: "Selected players"
                    size_hint_y: None
                    height: dp(24)
                ScrollView:
                    canvas.after:
                        Color:
                            rgba: 1, 1, 1, 1
                        Line:
                            rectangle: (self.x, self.y, self.width, self.height)
                            width: 1.2
                    GridLayout:
                        id: selected_list
                        cols: 1
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(2)
                        row_default_height: dp(56)
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            PrimaryButton:
                text: "Next: Seating"
                on_release: root.start_event()
            SecondaryButton:
                text: "Back"
                on_release: root.manager.current = "createevent_details"

<EventsListScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            TitleLabel:
                text: "Events"
            PrimaryButton:
                text: "Create Event"
                size_hint_x: None
                width: dp(140)
                height: dp(40)
                on_release: root.manager.current = "createevent_details"
        ScrollView:
            canvas.after:
                Color:
                    rgba: 1, 1, 1, 1
                Line:
                    rectangle: (self.x, self.y, self.width, self.height)
                    width: 1.2
            GridLayout:
                id: events_grid
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(2)
                row_default_height: dp(68)

<EventScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(76)
            canvas.before:
                Color:
                    rgba: 1,1,1,1
                Rectangle:
                    pos: self.pos
                    size: self.size
            BoxLayout:
                size_hint_y: None
                height: dp(38)
                spacing: dp(6)
                ScrollView:
                    size_hint_y: None
                    height: dp(38)
                    do_scroll_x: True
                    do_scroll_y: False
                    bar_width: 0
                    effect_y: None
                    scroll_y: 1
                    TitleLabel:
                        id: event_title
                        text: root.event_title
                        color: 0.1, 0.1, 0.1, 1
                        size_hint_x: None
                        size_hint_y: None
                        height: dp(38)
                        text_size: None, None
                        on_texture_size: self.width = self.texture_size[0] + dp(8)
                PrimaryButton:
                    text: "Close Event"
                    size_hint_x: None
                    width: dp(120)
                    height: dp(38)
                    on_release: root.close_event()
            BoxLayout:
                size_hint_y: None
                height: dp(38)
                spacing: dp(8)
                BodyLabel:
                    id: round_label
                    text: "Round: " + str(root.current_round)
                    color: 0.1, 0.1, 0.1, 1
                Widget:
                HeaderLabel:
                    id: timer_label
                    text: root.timer_text
                    size_hint_x: None
                    width: dp(130)
                    color: 0.1, 0.1, 0.1, 1
        ScrollView:
            GridLayout:
                id: matches_grid
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(6)
                row_default_height: dp(48)
        BoxLayout:
            size_hint_y: None
            height: dp(56)
            PrimaryButton:
                id: next_btn
                text: "Next Round"
                on_release: root.next_round()
            SecondaryButton:
                text: "Back to Events"
                on_release: root.manager.current = "eventslist"

<MatchRow>:
    size_hint_y: None
    height: dp(48)
    spacing: dp(8)
    canvas.before:
        Color:
            rgba: (0.95,0.95,0.95,1) if self.bye else (1,1,1,1)
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        text: root.p1_name
        color: 0,0,0,1
    Button:
        id: p1btn
        text: str(root.score1)
        size_hint_x: None
        width: dp(60)
        on_release: root.cycle_score(1)
        color: 0,0,0,1
    Label:
        text: "-"
        size_hint_x: None
        width: dp(20)
        color: 0,0,0,1
    Button:
        id: p2btn
        text: str(root.score2)
        size_hint_x: None
        width: dp(60)
        on_release: root.cycle_score(2)
        color: 0,0,0,1
    Label:
        text: root.p2_name
        color: 0,0,0,1

<SeatingScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        Label:
            markup: True
            text: "[b]Table Seating[/b]"
        ScrollView:
            GridLayout:
                id: seating_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(6)
                row_default_height: dp(32)
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            Button:
                text: "Randomize again"
                on_release: root.randomize()
            Button:
                text: "Begin Round 1"
                on_release: root.confirm_and_begin()

<StandingsScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        Label:
            id: standings_title
            markup: True
            text: "[b]Standings[/b]"
        ScrollView:
            GridLayout:
                id: standings_grid
                cols: 7
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(4)
                row_default_height: dp(42)
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            Button:
                text: "Back to Events"
                on_release: root.manager.current = "eventslist"

<LeagueScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        Label:
            text: "League Tracker (coming soon)"

<BingoScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        Label:
            text: "Bingo (coming soon)"

<DraftTimerScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        BoxLayout:
            id: timer_container
            orientation: "vertical"


<LifeTrackerScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(8)
        Label:
            text: "Life Tracker (content coming soon)"
            halign: 'center'
            valign: 'middle'
            text_size: self.size
